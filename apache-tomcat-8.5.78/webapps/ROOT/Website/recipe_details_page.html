<!DOCTYPE html>
<html>
  <head>
    <title>Recipe Details Page</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <link href="resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/>
    <link href="data/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/recipe_details_page/styles.css" type="text/css" rel="stylesheet"/>
    <script src="resources/scripts/jquery-3.2.1.min.js"></script>
    <script src="resources/scripts/axure/axQuery.js"></script>
    <script src="resources/scripts/axure/globals.js"></script>
    <script src="resources/scripts/axutils.js"></script>
    <script src="resources/scripts/axure/annotation.js"></script>
    <script src="resources/scripts/axure/axQuery.std.js"></script>
    <script src="resources/scripts/axure/doc.js"></script>
    <script src="resources/scripts/messagecenter.js"></script>
    <script src="resources/scripts/axure/events.js"></script>
    <script src="resources/scripts/axure/recording.js"></script>
    <script src="resources/scripts/axure/action.js"></script>
    <script src="resources/scripts/axure/expr.js"></script>
    <script src="resources/scripts/axure/geometry.js"></script>
    <script src="resources/scripts/axure/flyout.js"></script>
    <script src="resources/scripts/axure/model.js"></script>
    <script src="resources/scripts/axure/repeater.js"></script>
    <script src="resources/scripts/axure/sto.js"></script>
    <script src="resources/scripts/axure/utils.temp.js"></script>
    <script src="resources/scripts/axure/variables.js"></script>
    <script src="resources/scripts/axure/drag.js"></script>
    <script src="resources/scripts/axure/move.js"></script>
    <script src="resources/scripts/axure/visibility.js"></script>
    <script src="resources/scripts/axure/style.js"></script>
    <script src="resources/scripts/axure/adaptive.js"></script>
    <script src="resources/scripts/axure/tree.js"></script>
    <script src="resources/scripts/axure/init.temp.js"></script>
    <script src="resources/scripts/axure/legacy.js"></script>
    <script src="resources/scripts/axure/viewer.js"></script>
    <script src="resources/scripts/axure/math.js"></script>
    <script src="resources/scripts/axure/jquery.nicescroll.min.js"></script>
    <script src="data/document.js"></script>
    <script src="files/recipe_details_page/data.js"></script>
    <script type="text/javascript">
      $axure.utils.getTransparentGifPath = function() { return 'resources/images/transparent.gif'; };
      $axure.utils.getOtherPath = function() { return 'resources/Other.html'; };
      $axure.utils.getReloadPath = function() { return 'resources/reload.html'; };
    </script>
  </head>
  <body>
    <div id="base" class="">

      <!-- Unnamed (Dynamic Panel) -->
      <div id="u170" class="ax_default">
        <div id="u170_state0" class="panel_state" data-label="State 1" style="">
          <div id="u170_state0_content" class="panel_state_content">

            <!-- Unnamed (Navigation Panel Logged In) -->

            <!-- Navigation bar for logged in (Group) -->
            <div id="u172" class="ax_default" data-label="Navigation bar for logged in" data-left="19" data-top="0" data-width="1910" data-height="64">

              <!-- Unnamed (Group) -->
              <div id="u173" class="ax_default" data-left="19" data-top="0" data-width="1910" data-height="64">

                <!-- Unnamed (Group) -->
                <div id="u174" class="ax_default" data-left="19" data-top="0" data-width="1910" data-height="64">

                  <!-- Unnamed (Rectangle) -->
                  <div id="u175" class="ax_default box_1">
                    <img id="u175_img" class="img " src="images/home/u31.svg"/>
                    <div id="u175_text" class="text " style="display:none; visibility: hidden">
                      <p></p>
                    </div>
                  </div>

                  <!-- Profile Button (Shape) -->
                  <div id="u176" class="ax_default primary_button" data-label="Profile Button">
                    <img id="u176_img" class="img " src="images/home/nav_login_button_u33.svg"/>
                    <div id="u176_text" class="text ">
                      <p><span>PROFILE</span></p>
                    </div>
                  </div>

                  <!-- noodles (Image) -->
                  <div id="u177" class="ax_default image" data-label="noodles">
                    <img id="u177_img" class="img " src="images/home/noodles_u34.svg"/>
                    <div id="u177_text" class="text " style="display:none; visibility: hidden">
                      <p></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="u171" style="display:none; visibility:hidden;"></div>
          </div>
        </div>
      </div>

      <!-- Recipe Details Panel (Group) -->
      <div id="u178" class="ax_default" data-label="Recipe Details Panel" data-left="907" data-top="90" data-width="369" data-height="523">

        <!-- search page panel (Group) -->
        <div id="u179" class="ax_default" data-label="search page panel" data-left="907" data-top="90" data-width="369" data-height="523">

          <!-- Unnamed (Rectangle) -->
          <div id="u180" class="ax_default box_1">
            <div id="u180_div" class=""></div>
            <div id="u180_text" class="text " style="display:none; visibility: hidden">
              <p></p>
            </div>
          </div>

          <!-- Unnamed (Rectangle) -->
          <div id="u181" class="ax_default heading_1">
            <img id="u181_img" class="img " src="images/recipe_details_page/u181.svg"/>
            <div id="u181_text" class="text ">
              <p><span>INGREDIENTS:</span></p>
            </div>
          </div>

          <!-- Unnamed (Rectangle) -->
          <div id="u182" class="ax_default heading_1">
            <img id="u182_img" class="img " src="images/recipe_details_page/u182.svg"/>
            <div id="u182_text" class="text ">
              <p><span>TIME PREPARATION:</span></p>
            </div>
          </div>

          <!-- rs 5 (Text Field) -->
          <div id="u183" class="ax_default text_field" data-label="rs 5">
            <div id="u183_div" class=""></div>
            <input id="u183_input" type="text" value="" disabled="true" class="u183_input"/>
          </div>
        </div>

        <!-- RD - Ingredients (Text Field) -->
        <div id="u184" class="ax_default text_field" data-label="RD - Ingredients">
          <div id="u184_div" class=""></div>
          <input id="u184_input" name="ingredients" disabled="true" type="text" value="" class="u184_input"/>
        </div>

        <!-- Unnamed (Rectangle) -->
        <div id="u185" class="ax_default heading_1">
          <img id="u185_img" class="img " src="images/recipe_details_page/u185.svg"/>
          <div id="u185_text" class="text ">
            <p><span>SERVES:</span></p>
          </div>
        </div>

        <!-- rs 1 (Text Field) -->
        <div id="u186" class="ax_default text_field" data-label="rs 1">
          <div id="u186_div" class=""></div>
          <input id="u186_input" type="text" value=""disabled="true" class="u186_input"/>
        </div>

        <!-- rs 1 (Text Field) -->
        <div id="u187" class="ax_default text_field" data-label="rs 1">
          <div id="u187_div" class=""></div>
          <input id="u187_input" type="text" value=""disabled="true" class="u187_input"/>
        </div>

        <!-- RD - time (Text Field) -->
        <div id="u188" class="ax_default text_field" data-label="RD - time">
          <div id="u188_div" class=""></div>
          <input id="u188_input" type="text" name="timePreparation" disabled="true" value="" class="u188_input"/>
        </div>

        <!-- RD - serves (Text Field) -->
        <div id="u189" class="ax_default text_field" data-label="RD - serves">
          <div id="u189_div" class=""></div>
          <input id="u189_input" type="text" name="serves" disabled="true" value="" class="u189_input"/>
        </div>
      </div>

      <!-- Recipe panel (Group) -->
      <div id="u190" class="ax_default" data-label="Recipe panel" data-left="105" data-top="90" data-width="773" data-height="882">

        <!-- Unnamed (Rectangle) -->
        <div id="u191" class="ax_default box_1">
          <div id="u191_div" class=""></div>
          <div id="u191_text" class="text " style="display:none; visibility: hidden">
            <p></p>
          </div>
        </div>

        <!-- RP Name of Dish (Rectangle) -->
        <div id="u192" class="ax_default heading_1" data-label="RP Name of Dish">
          <img id="u192_img" class="img " src="images/recipe_details_page/rp_name_of_dish_u192.svg"/>
          <div id="u192_text" class="text ">
            <p><span name="recipesName">NAME OF DISH</span></p>
          </div>
        </div>

        <!-- RP Image of Dish (Image) -->
        <div id="u193" class="ax_default image" data-label="RP Image of Dish">
          <img id="u193_img" class="img recipesImage" src="images/recipe_details_page/rp_image_of_dish_u193.svg"/>
          <div id="u193_text" class="text " style="display:none; visibility: hidden">
            <p></p>
          </div>
        </div>

        <!-- RP Method (Text Field) -->
        <div id="u194" class="ax_default text_field" data-label="RP Method">
          <div id="u194_div" class=""></div>
          <textarea id="u194_input" name="recipesDetailDescribe" type="text" value="" disabled="true" class="u194_input"></textarea>
        </div>

        <!-- heart  (Image) -->
        <div id="u195" class="ax_default image favouriteRecipes" data-label="heart ">
          <img id="u195_img" class="img " src="images/recipe_details_page/heart_black.png"/>
          <div id="u195_text" class="text " style="display:none; visibility: hidden">
            <p></p>
          </div>
        </div>
      </div>

      <!-- Unnamed (Rectangle) -->
      <div id="u196" class="ax_default box_1">
        <img id="u196_img" class="img " src="images/home/u66.svg"/>
        <div id="u196_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>
    </div>
    <script src="resources/scripts/axure/ios.js"></script>
    <script src="./resources/layui/layui.js"></script>
    <script src="./resources/scripts/analysisParam.js"></script>
    <script src="./resources/jquery.cookie.js"></script>
    <script>
      function removeArrValue(arr,value){
        for(let i=0;i<arr.length;i++){
          if(arr[i]==value){
            arr.splice(i,1);
          }
        }
      }
      $(function(){
        var layer = {};
        var recipesId = UrlParm.parm("recipesId");
        layui.use(['layer'],function(){
          layer = layui.layer;
          var authStr = $.cookie('authStr');
          console.log(authStr);
          var loveListStr = authStr.split(":")[2];
          var loveList = loveListStr?loveListStr.split("-"):[];
          layer.msg("recipesId is "+recipesId);
          for(j = 0; j < recipesDataList.length; j++) {
            if(recipesDataList[j].id==recipesId){
              recipes = recipesDataList[j];
              $("[name='recipesName']").html(recipes.name);
              $(".recipesImage").attr("src",recipes.imageSrc);
              $("[name='recipesDetailDescribe']").val(recipes.recipesDetailDescribe);
              $("[name='ingredients']").val(recipes.ingredients);
              $("[name='timePreparation']").val(recipes.timePreparation);
              $("[name='serves']").val(recipes.serves);
              if(loveList!=undefined && loveList.join("").indexOf(recipes.id)>-1){
                $(".favouriteRecipes").attr("islike","1");
                $(".favouriteRecipes").find('img').attr("src","images/recipe_details_page/heart_solid_red.png");
              }
            }
          }
          $.ajax({
            url:'/{apiAddress}/recipes/recipesDetail',
            async:false,
            data:{recipesId:recipesId},
            dataType:'json',
            success:function(res){
              if(res.code==200){
                let recipes = res.recipes;
                layer.msg("Get recipe details");
                /*
                  var recipes = {id:1,
                  name:'recipe1',
                  imageSrc:'images/recipes_image/食谱1.jpg',
                  recipesDetailDescribe:'This is a recipe',
                  ingredients:'eggs, onion, ham',
                  timePreparation:'120 minutes',
                  serves:'',
                }
                */
                $("[name='recipesName']").html(recipes.name);
                $(".recipesImage").attr("src",recipes.imageSrc);
                $("[name='recipesDetailDescribe']").val(recipes.recipesDetailDescribe);
                $("[name='ingredients']").val(recipes.ingredients);
                $("[name='timePreparation']").val(recipes.timePreparation);
                $("[name='serves']").val(recipes.serves);
              }else{
                layer.msg("registration failed");
              }
            }
          });
          //标记喜爱，不喜爱
          $(".favouriteRecipes").click(function(e){
              e.stopPropagation();
              var islike = $(this).attr("islike");
              var $this = $(this);
              var data = {};
              var authStr = $.cookie('authStr');
              console.log(authStr);
              var username = authStr.split(":")[0];
              data.recipe_id= recipesId;
              data.recipeid= recipesId;
              data.username = username;
              //如果当前是喜爱，则调用unlike，否则调用like
              console.log(islike)
              if(islike=='1'){
                layer.msg("Remove favorite recipesid："+recipesId);
                $this.attr("islike","0");
                $this.attr("src","images/recipe_details_page/heart_black.png");
                removeArrValue(loveList,parseInt(recipesId));
                /*$.ajax({
                  url:'http://127.0.0.1:5000/recipes/likes',
                  data: JSON.stringify(data),
                  dataType:'json',
                  type:'delete',
                  contentType: "application/json",
                  success:function(res){
                    if(res.code==200){
                      layer.msg(res.msg);
                      $this.attr("islike","0");
                      $this.attr("src","images/recipe_details_page/heart_black.png");
                    }else{
                      layer.msg("取消喜欢失败");
                    }
                  }
                });*/
              }else{
                layer.msg("Add favorite recipes id："+recipesId);
                $this.attr("islike","1");
                $this.attr("src","images/recipe_details_page/heart_solid_red.png");
                if(loveList.indexOf(parseInt(recipesId))==-1){
                  loveList.push(parseInt(recipesId));
                }
                
                /*$.ajax({
                  url:'http://127.0.0.1:5000/recipes/likes',
                  async:false,
                  data: JSON.stringify(data),
                  dataType:'json',
                  type:'post',
                  contentType: "application/json",
                  success:function(res){
                    if(res.code==200){
                      layer.msg(res.msg);
                      $this.attr("islike","1");
                      $this.attr("src","images/recipe_details_page/heart_solid_red.png");
                    }else{
                      layer.msg("标记喜欢失败");
                    }
                  }
                });*/
              }
              console.log(authStr+":"+loveList.join('-'))
              $.cookie('authStr',authStr.split(":")[0]+":"+authStr.split(":")[1]+":"+loveList.join('-'));
              
            });
        });
        
      })
    </script>
  </body>
</html>
