<!DOCTYPE html>
<html>
  <head>
    <title>Search Page</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <link href="resources/css/axure_rp_page.css" type="text/css" rel="stylesheet"/>
    <link href="data/styles.css" type="text/css" rel="stylesheet"/>
    <link href="files/search_page/styles.css" type="text/css" rel="stylesheet"/>
    <script src="resources/scripts/jquery-3.2.1.min.js"></script>
    <script src="resources/scripts/axure/axQuery.js"></script>
    <script src="resources/scripts/axure/globals.js"></script>
    <script src="resources/scripts/axutils.js"></script>
    <script src="resources/scripts/axure/annotation.js"></script>
    <script src="resources/scripts/axure/axQuery.std.js"></script>
    <script src="resources/scripts/axure/doc.js"></script>
    <script src="resources/scripts/messagecenter.js"></script>
    <script src="resources/scripts/axure/events.js"></script>
    <script src="resources/scripts/axure/recording.js"></script>
    <script src="resources/scripts/axure/action.js"></script>
    <script src="resources/scripts/axure/expr.js"></script>
    <script src="resources/scripts/axure/geometry.js"></script>
    <script src="resources/scripts/axure/flyout.js"></script>
    <script src="resources/scripts/axure/model.js"></script>
    <script src="resources/scripts/axure/repeater.js"></script>
    <script src="resources/scripts/axure/sto.js"></script>
    <script src="resources/scripts/axure/utils.temp.js"></script>
    <script src="resources/scripts/axure/variables.js"></script>
    <script src="resources/scripts/axure/drag.js"></script>
    <script src="resources/scripts/axure/move.js"></script>
    <script src="resources/scripts/axure/visibility.js"></script>
    <script src="resources/scripts/axure/style.js"></script>
    <script src="resources/scripts/axure/adaptive.js"></script>
    <script src="resources/scripts/axure/tree.js"></script>
    <script src="resources/scripts/axure/init.temp.js"></script>
    <script src="resources/scripts/axure/legacy.js"></script>
    <script src="resources/scripts/axure/viewer.js"></script>
    <script src="resources/scripts/axure/math.js"></script>
    <script src="resources/scripts/axure/jquery.nicescroll.min.js"></script>
    <script src="data/document.js"></script>
    <script src="files/search_page/data.js"></script>
    <script type="text/javascript">
      $axure.utils.getTransparentGifPath = function() { return 'resources/images/transparent.gif'; };
      $axure.utils.getOtherPath = function() { return 'resources/Other.html'; };
      $axure.utils.getReloadPath = function() { return 'resources/reload.html'; };
    </script>
    <style>
      .message_input{
        width: 168px;
                height: 25px;
                padding: 2px 2px 2px 2px;
                font-family: 'Arial', sans-serif;
                font-weight: 400;
                font-style: normal;
                font-size: 13px;
                letter-spacing: normal;
                color: #000000;
                text-align: left;
                text-transform: none;
                background-color: transparent;
      }
    </style>
  </head>
  <body>
    <div id="base" class="">

      <!-- Unnamed (Dynamic Panel) -->
      <div id="u197" class="ax_default">
        <div id="u197_state0" class="panel_state" data-label="State 1" style="">
          <div id="u197_state0_content" class="panel_state_content">

            <!-- Unnamed (Navigation Panel Logged In) -->

            <!-- Navigation bar for logged in (Group) -->
            <div id="u199" class="ax_default" data-label="Navigation bar for logged in" data-left="19" data-top="0" data-width="1910" data-height="64">

              <!-- Unnamed (Group) -->
              <div id="u200" class="ax_default" data-left="19" data-top="0" data-width="1910" data-height="64">

                <!-- Unnamed (Group) -->
                <div id="u201" class="ax_default" data-left="19" data-top="0" data-width="1910" data-height="64">

                  <!-- Unnamed (Rectangle) -->
                  <div id="u202" class="ax_default box_1">
                    <img id="u202_img" class="img " src="images/home/u31.svg"/>
                    <div id="u202_text" class="text " style="display:none; visibility: hidden">
                      <p></p>
                    </div>
                  </div>

                  <!-- Profile Button (Shape) -->
                  <div id="u203" class="ax_default primary_button" data-label="Profile Button">
                    <img id="u203_img" class="img " src="images/home/nav_login_button_u33.svg"/>
                    <div id="u203_text" class="text ">
                      <p><span>PROFILE</span></p>
                    </div>
                  </div>

                  <!-- noodles (Image) -->
                  <div id="u204" class="ax_default image" data-label="noodles">
                    <img id="u204_img" class="img " src="images/home/noodles_u34.svg"/>
                    <div id="u204_text" class="text " style="display:none; visibility: hidden">
                      <p></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="u198" style="display:none; visibility:hidden;"></div>
          </div>
        </div>
      </div>

      <!-- search page panel (Group) -->
      <div id="u205" class="ax_default" data-label="search page panel" data-left="133" data-top="104" data-width="369" data-height="333">

        <!-- Unnamed (Rectangle) -->
        <div id="u206" class="ax_default box_1">
          <div id="u206_div" class=""></div>
          <div id="u206_text" class="text " style="display:none; visibility: hidden">
            <p></p>
          </div>
        </div>

        <!-- Unnamed (Rectangle) -->
        <div id="u207" class="ax_default heading_1">
          <img id="u207_img" class="img " src="images/search_page/u207.svg"/>
          <div id="u207_text" class="text ">
            <p><span>FILTERS</span></p>
          </div>
        </div>

        <!-- Unnamed (Rectangle) -->
        <div id="u208" class="ax_default heading_2">
          <div id="u208_div" class=""></div>
          <div id="u208_text" class="text ">
            <p><span>Show me recipes with:</span></p>
          </div>
        </div>

        <!-- Unnamed (Rectangle) -->
        <div id="u209" class="ax_default heading_2">
          <div id="u209_div" class=""></div>
          <div id="u209_text" class="text ">
            <p><span>Show me recipes without:</span></p>
          </div>
        </div>

        <!-- Unnamed (Group) -->
        <div id="u210" class="ax_default" data-left="190" data-top="220" data-width="255" data-height="30">

          <!-- Seach-BG (Rectangle) -->
          <div id="u211" class="ax_default box_1" data-label="Seach-BG">
            <div id="u211_div" class=""></div>
            <div id="u211_text" class="text " style="display:none; visibility: hidden">
              <p></p>
            </div>
          </div>

          <!-- Unnamed (Image) -->
          <div id="u212" class="ax_default image">
            <img id="u212_img" class="img " src="images/home/u82.jpg"/>
            <div id="u212_text" class="text " style="display:none; visibility: hidden">
              <p></p>
            </div>
          </div>

          <!-- with ingredients (Text Field) -->
          <div id="u213" class="ax_default text_field" data-label="with ingredients">
            <img id="u213_img" class="img " src="images/search_page/with_ingredients_u213.svg"/>
            <input id="u213_input" type="text" name="recipesSearch" value="" class="u213_input"/>
          </div>
        </div>

        <!-- Unnamed (Group) -->
        <div id="u214" class="ax_default" data-left="190" data-top="311" data-width="255" data-height="30">

          <!-- Seach-BG (Rectangle) -->
          <div id="u215" class="ax_default box_1" data-label="Seach-BG">
            <div id="u215_div" class=""></div>
            <div id="u215_text" class="text " style="display:none; visibility: hidden">
              <p></p>
            </div>
          </div>

          <!-- Unnamed (Image) -->
          <div id="u216" class="ax_default image">
            <img id="u216_img" class="img " src="images/home/u82.jpg"/>
            <div id="u216_text" class="text " style="display:none; visibility: hidden">
              <p></p>
            </div>
          </div>

          <!-- without ingredients (Text Field) -->
          <div id="u217" class="ax_default text_field" data-label="without ingredients">
            <img id="u217_img" class="img " src="images/search_page/without_ingredients_u217.svg"/>
            <input id="u217_input" name="recipesSearch2" type="text" value="" class="u217_input"/>
          </div>
        </div>
      </div>

      <!-- Unnamed (Rectangle) -->
      <div id="u218" class="ax_default box_1">
        <img id="u218_img" class="img " src="images/home/u66.svg"/>
        <div id="u218_text" class="text " style="display:none; visibility: hidden">
          <p></p>
        </div>
      </div>

      <!-- Search Button (Rectangle) -->
      <div id="u219" class="ax_default primary_button" data-label="Search Button">
        <div id="u219_div" class=""></div>
        <div id="u219_text" class="text ">
          <p class="recipesSearchBtn" style="cursor: pointer;"><span>SEARCH</span></p>
        </div>
      </div>
      <div id="template" style="display: none; width: 750px;height: 250px;    background: inherit;
      background-color: rgba(255, 255, 255, 1);
      box-sizing: border-box;
      border-width: 2px;
      border-style: solid;
      border-color: rgba(237, 105, 64, 1);
      border-radius: 5px;">
      <div style="display: inline-block;width: 430px;padding: 20px 28px;float: left;">
        <div  style="cursor: pointer; 
        font-weight: 700;
        font-style: italic;
        font-size: 24px;
        color: #40C0E7;">
          <div id="" class="" tabindex="0"></div>
          <div id="" class="text recipesName">
            <p style="display: inline-block;margin-right: 10px;float: left;"><span name="recipesName">NAME OF DISH</span></p><img id="" class="img favouriteRecipes" style="width: 30px;height: 31px;" src="images/recipe_details_page/heart__u195.png"> 
            <div>
              <span style="font-weight: 700; font-style: normal; font-size: 16px;float: left;color: #000;margin-right: 10px;">Ingredients:</span>
              <textarea name="ingredients" disabled="true" style="width: 320px;resize: none;
              height: 85px;
              padding: 2px 2px 2px 2px;
              font-family: 'Arial', sans-serif;
              font-weight: 400;
              font-style: normal;
              font-size: 13px;
              letter-spacing: normal;
              color: #000000;
              vertical-align: none;
              text-align: left;
              text-transform: none;
              background-color: transparent;"></textarea>
            </div>
            <div>
              <span style="font-weight: 700; font-style: normal; font-size: 16px;color: #000;margin-right: 10px;">Preparation time:</span>
              <input class="message_input" name="timePreparation" disabled="true"/>
            </div>
            <div>
              <span style="font-weight: 700; font-style: normal; font-size: 16px;color: #000;margin-right: 10px;">Serves:</span>
              <input class="message_input" name="serves" disabled="true"/>
            </div>
          </div>
        </div>
      </div>
      <div style="display: inline-block;width: 250px;padding: 20px 2px;">
        <img id="" style="width: 225px;height: 201px;" class="img recipesImage" src="images/search_page/sp_picture_u224.svg">
      </div>

      
    </div>    
      <div id="recipesBase" style="position: absolute; left: 538px; top: 104px;">
        
      </div>
      
     

    </div>
    <script src="resources/scripts/axure/ios.js"></script>
    
    <script src="./resources/layui/layui.js"></script>
    <script src="./resources/scripts/analysisParam.js"></script>
    <script src="./resources/jquery.cookie.js"></script>
    <script>
      //食谱数据list，用户喜爱list
      function dataToDom(list,loveList){
        $("#recipesBase").empty();
        console.log(loveList);
        
        for(j = 0; j < list.length; j++) {
            let recipes = list[j];
            let dom = $("#template").clone(true);
            dom.removeAttr("id");
            dom.css("display","block");
            $("#recipesBase").append(dom).append("<br/>");
            $("[name='recipesName']",dom).html(recipes.name);
            $(".recipesName",dom).attr("recipesId",recipes.id);
            $(".recipesImage",dom).attr("src",recipes.imageSrc);
            $("[name='recipesDetailDescribe']",dom).val(recipes.recipesDetailDescribe);
            $("[name='ingredients']",dom).val(recipes.ingredients);
            $("[name='timePreparation']",dom).val(recipes.timePreparation);
            $("[name='serves']",dom).val(recipes.serves);
            if(loveList!=undefined && loveList.join("").indexOf(recipes.id)>-1){
              $(".favouriteRecipes",dom).attr("islike","1");
              $(".favouriteRecipes",dom).attr("src","images/recipe_details_page/heart_solid_red.png");
            }else{
              $(".favouriteRecipes",dom).attr("islike","0");
              $(".favouriteRecipes",dom).attr("src","images/recipe_details_page/heart_black.png");
            }
            
          }
      }
      function removeArrValue(arr,value){
        for(let i=0;i<arr.length;i++){
          if(arr[i]==value){
            arr.splice(i,1);
          }
        }
      }
      $(function(){
        // $.cookie('authStr','12345678@qq.com:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTY0OTM0MjgzMiwianRpIjoiOGI5MmZmYjYtNjcwOS00Y2RiLTgyNGUtNzMyZGQ0YTYxMTg5IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6IjEyMzQ1Njc4QHFxLmNvbSIsIm5iZiI6MTY0OTM0MjgzMiwiZXhwIjoxNjQ5MzQzNzMyfQ.J4Z1ZQ3K1Jc1N-tTiadVu7grqatlMBulu_gQyfblx54')
        var authStr = $.cookie('authStr');
        console.log(authStr);
        var loveListStr = authStr.split(":")[2];
        var loveList = loveListStr?loveListStr.split("-"):[];
        var recipesSearch = UrlParm.parm("recipesSearch");
        layui.use(['layer'],function(){
          layer = layui.layer;
          $("[name='recipesSearch']").val(recipesSearch);
          //下面是测试数据，后台返回数据应该于此处数据类型一致，若不一致，需适配调整前台
          //start
          let newArr = [];
          for(let j=0;j<recipesDataList.length;j++){
            if(recipesDataList[j].name.indexOf(recipesSearch)>-1){
              newArr.push(recipesDataList[j]);
            }
          }
          dataToDom(newArr,loveList);
          //end
          $.ajax({
              url:'http://127.0.0.1:5000/recipes/query',
              async:false,
              data:{recipesSearch:recipesSearch},
              dataType:'json',
              success:function(res){
                if(res.code==200){
                  let recipesArr = res.recipesArr;
                  dataToDom(recipesArr);
                  layer.msg("获取食谱查询结果");
                }else{
                  layer.msg("查询失败");
                }
              }
            });
            //食谱详情
            $(".recipesName").click(function(e){
              e.stopPropagation();
              let recipesId = $(this).attr("recipesId");
              window.location = "./recipe_details_page.html?recipesId="+recipesId;
            });
            //标记喜爱，不喜爱
            $(".favouriteRecipes").click(function(e){
              e.stopPropagation();
              var recipesId = $(this).parent().attr("recipesId");
              var islike = $(this).attr("islike");
              var $this = $(this);
              var data = {};
              var authStr = $.cookie('authStr');
              console.log(authStr);
              var username = authStr.split(":")[0];
              data.recipe_id= recipesId;
              data.recipeid= recipesId;
              data.username = username;
              //如果当前是喜爱，则调用unlike，否则调用like
              console.log(islike)
              if(islike=='1'){
                layer.msg("Remove favorite recipesid："+recipesId);
                $this.attr("islike","0");
                $this.attr("src","images/recipe_details_page/heart_black.png");
                removeArrValue(loveList,parseInt(recipesId));
                /*$.ajax({
                  url:'http://127.0.0.1:5000/recipes/likes',
                  data: JSON.stringify(data),
                  dataType:'json',
                  type:'delete',
                  contentType: "application/json",
                  success:function(res){
                    if(res.code==200){
                      layer.msg(res.msg);
                      $this.attr("islike","0");
                      $this.attr("src","images/recipe_details_page/heart_black.png");
                    }else{
                      layer.msg("取消喜欢失败");
                    }
                  }
                });*/
              }else{
                layer.msg("Add favorite recipesid："+recipesId);
                $this.attr("islike","1");
                $this.attr("src","images/recipe_details_page/heart_solid_red.png");
                if(loveList.indexOf(parseInt(recipesId))==-1){
                  loveList.push(parseInt(recipesId));
                }
                
                /*$.ajax({
                  url:'http://127.0.0.1:5000/recipes/likes',
                  async:false,
                  data: JSON.stringify(data),
                  dataType:'json',
                  type:'post',
                  contentType: "application/json",
                  success:function(res){
                    if(res.code==200){
                      layer.msg(res.msg);
                      $this.attr("islike","1");
                      $this.attr("src","images/recipe_details_page/heart_solid_red.png");
                    }else{
                      layer.msg("标记喜欢失败");
                    }
                  }
                });*/
              }
              console.log(authStr+":"+loveList.join('-'))
              $.cookie('authStr',authStr.split(":")[0]+":"+authStr.split(":")[1]+":"+loveList.join('-'));
              
            });
            //食谱检索
            $(".recipesSearchBtn").click(function(e){
              e.stopPropagation();
              let recipesSearch = $("[name='recipesSearch']").val()==undefined?'':$("[name='recipesSearch']").val();
              let recipesSearch2 = $("[name='recipesSearch2']").val()==undefined?'':$("[name='recipesSearch2']").val();
              var data = {recipesSearch:recipesSearch,recipesSearch2:recipesSearch2}
              let newArr = [];
              for(let j=0;j<recipesDataList.length;j++){
                if(recipesDataList[j].name.indexOf(recipesSearch)>-1 && recipesDataList[j].recipesDetailDescribe.indexOf(recipesSearch2)>-1){
                  newArr.push(recipesDataList[j]);
                }
              }
              dataToDom(newArr,loveList);
              /*
              $.ajax({
                url:'http://127.0.0.1:5000/recipes/query',
                async:false,
                data: JSON.stringify(data),
                dataType:'json',
                type:'post',
                contentType: "application/json",
                success:function(res){
                  if(res.code==200){
                    let recipesArr = res.recipesArr;
                    dataToDom(recipesArr);
                    layer.msg("获取食谱查询结果");
                  }else{
                    layer.msg("查询失败");
                  }
                }
              });
              */
            })
          });
        });
    </script>
  </body>
</html>
